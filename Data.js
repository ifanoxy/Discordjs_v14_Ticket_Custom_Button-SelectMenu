import{ActionRowBuilder as e,ButtonBuilder as t,ButtonStyle as n,ChannelType as a,Client as s,Collection as i,EmbedBuilder as o,PermissionsBitField as r,SelectMenuBuilder as l,SlashCommandBuilder as m}from"discord.js";import*as d from"fs";import*as c from"colors";export class IfanoxyBot extends s{constructor(){super({intents:4609}),this.commands=new i,this.on("interactionCreate",async(s,i)=>{switch(!0){case s.isChatInputCommand():{let l=this.commands.get(s.commandName);if(!l)return s.reply("Il y a un probl\xe8me avec cette commande ! Elle est introuvable");l.execute(s,i)}break;case s.isButton():{if("Ticket_Delete"==s.customId){let m=s.guild.channels.cache.get(s.channelId);s.reply({content:"Fermeture du ticket..."}).then(()=>{m.delete().catch(e=>{console.log(e)})});break}let d=s.customId.split("_"),c=d[0],u=d[1];var p=s.guild.channels.cache.filter(e=>e.type==a.GuildCategory).map(e=>e);let h;for(let g of p)if(g.name==u){h=g;break}void 0==h&&(h=s.guild.channels.create({name:u,type:a.GuildCategory,permissionOverwrites:[{id:s.guild.roles.everyone,deny:[r.Flags.ViewChannel]}]})),console.log("[Ticket]".magenta+` Nouveau ticket de ${s.user.tag}`.green),s.guild.channels.create({name:`${s.member.user.username}-${c}`,parent:await h,type:a.GuildText,topic:s.message.id,permissionOverwrites:[{id:s.user.id,allow:[r.Flags.SendMessages,r.Flags.ViewChannel,r.Flags.ReadMessageHistory]},{id:s.guild.roles.everyone,deny:[r.Flags.ViewChannel]},]}).then(a=>{let i=new o().setAuthor({iconURL:s.user.avatarURL(),name:`Ticket de ${s.member.user.username}`}).setDescription(`**Bien le bonjour ${s.user.username} !**
 Vous venez de cr\xe9er un ticket pour la raison **${c}**.`).setTimestamp().setColor("Navy").setFooter({text:`Ticket syst\xe8me`}),r=new e().addComponents(new t().setCustomId("Ticket_Delete").setLabel("Fermer le Ticket").setStyle(n.Danger));a.send({content:`<@!${s.user.id}>`,embeds:[i],components:[r]}),s.reply({embeds:[new o().setColor("Blurple").setDescription(`Votre ticket \xe0 \xe9t\xe9 cr\xe9\xe9 ! <#${a.id}> Il a \xe9t\xe9 cr\xe9er dans la cat\xe9gorie <#${a.parentId}>`)],ephemeral:!0})})}break;case s.isSelectMenu():{let b=s.customId.split("_"),y=s.values[0].split("_")[0],w=b[1];var p=s.guild.channels.cache.filter(e=>e.type==a.GuildCategory).map(e=>e);let f;for(let x of p)if(x.name==w){f=x;break}void 0==f&&(f=s.guild.channels.create({name:w,type:a.GuildCategory,permissionOverwrites:[{id:s.guild.roles.everyone,deny:[r.Flags.ViewChannel]}]})),console.log("[Ticket]".magenta+` Nouveau ticket de ${s.user.tag}`.green),s.guild.channels.create({name:`${s.member.user.username}-${y}`,parent:await f,type:a.GuildText,topic:s.message.id,permissionOverwrites:[{id:s.user.id,allow:[r.Flags.SendMessages,r.Flags.ViewChannel,r.Flags.ReadMessageHistory]},{id:s.guild.roles.everyone,deny:[r.Flags.ViewChannel]},]}).then(a=>{let i=new o().setAuthor({iconURL:s.user.avatarURL(),name:`Ticket de ${s.member.user.username}`}).setDescription(`**Bien le bonjour ${s.user.username} !**
 Vous venez de cr\xe9er un ticket pour la raison **${y}**.`).setTimestamp().setColor("Navy").setFooter({text:`Ticket syst\xe8me`}),r=new e().addComponents(new t().setCustomId("Ticket_Delete").setLabel("Fermer le Ticket").setStyle(n.Danger));a.send({content:`<@!${s.user.id}>`,embeds:[i],components:[r]}),s.reply({embeds:[new o().setColor("Blurple").setDescription(`Votre ticket \xe0 \xe9t\xe9 cr\xe9\xe9 ! <#${a.id}> Il a \xe9t\xe9 cr\xe9er dans la cat\xe9gorie <#${a.parentId}>`)],ephemeral:!0})})}}})}async initCommands(){let a=d.readdirSync("./dataStorage").filter(e=>e.endsWith(".json"));var s=[];for(let i of a){let r=JSON.parse(d.readFileSync(`./dataStorage/${i}`)),c=new m,u=0;var p=[];c.setName(i.replace(".json","").toString()),c.setDescription("Send Ticket message"),s.push(c.toJSON());let h={data:c,execute(a,s){let i=new o().setDescription("Vous rencontrez un probl\xe8me ?\nCr\xe9er un ticket en choisissant la bonne cat\xe9gorie !\n");for(let m of r){if(0==m.length)break;let d=new e;for(let h of m){if("Button"==h.type)null!==h.emoji.name?(d.addComponents(new t().setCustomId(`${h.label}_${c.name}_${u}`).setLabel(`${h.label}`).setStyle(n[`${h.style}`]).setEmoji({name:h.emoji.name,id:h.emoji.id,animated:h.emoji.animated})),i.setDescription(i.data.description+`
> <:${h.emoji.name}:${h.emoji.id}> **${h.label}**`)):(d.addComponents(new t().setCustomId(`${h.label}_${c.name}_${u}`).setLabel(`${h.label}`).setStyle(n[`${String(h.style)}`]||"1")),i.setDescription(i.data.description+`
> **${h.label}**`));else{let g=new l;g.setPlaceholder(h.placeHolder),g.setCustomId(`${h.setName}_${c.name}_${u}`);var b=h.options;b=b.map(e=>(u++,Object({label:e.label,description:e.description,value:`${e.label}_${c.name}_${u}`}))),g.addOptions(b.map(e=>e)),d.addComponents(g),i.setDescription(i.data.description+`
> **${h.label}**`)}u++}p.push(d)}a.reply({embeds:[new o().setColor("Blurple").setDescription("Votre message pour les ticket a \xe9t\xe9 envoy\xe9 dans ce channel avec succ\xe8s !")],ephemeral:!0}),a.channel.send({embeds:[i.setTitle("Cr\xe9ateur de ticket").setColor("Orange").setThumbnail().setFooter({text:"Ticket - Creator"})],components:p})}};this.commands.set(c.name,h),console.log("[+]".green+` Ajout de la commande Ticket : ${c.name}`.cyan)}await this.application?.commands.set(s)}}export class Ticket{constructor(e){if(!e)throw Error("\x1b[31m \nTicketName is not defined! \x1b[33m \n\nexample: \nnew Ticket('Random Name')\n \x1b[0m");this.TicketName=e.toLowerCase().replace(" ","-")}rows=[[],[],[],[],[]];addButton({setName:e,style:t,emojiName:n,emojiId:a,emojiAnimated:s}){try{if(!e)throw Error("\x1b[31m \nname is not defined! \x1b[33m \n\nexample: \n.addButton({\n    setName: 'Exemple of name'\n})\n \x1b[0m");if(!t)throw Error("\x1b[31m \nstyle is not defined! \x1b[33m \n\nexample: \n.addButton({\n    style: ButtonStyle.Primary\n})\n \x1b[0m");if(5==this.rows[4].length||this.rows[4][0]&&"Select_Menu"==this.rows[4][0].type)throw Error("\x1b[31m \nYou have reached the button and select menu limit! \x1b[33m \n\nLimits: 25 Buttons or 5 SelectMenus\n \x1b[0m");for(let i of this.rows)if(!(i.length>4)){if(i[0]&&"Select_Menu"==i[0].type)continue;i.push({label:e,style:t,emoji:{name:n||null,id:a||null,animated:s||!1},type:"Button"});break}return d.existsSync("dataStorage")||d.mkdirSync("dataStorage"),d.writeFileSync("dataStorage/"+this.TicketName+".json",JSON.stringify(this.rows)),this}catch(o){console.log(o),process.exit(0)}}addSelect_Menu({setName:e,placeHolder:t,options:n=[{label,description}]}){try{if(!e)throw Error("\x1b[31m \nname is not defined! \x1b[33m \n\nexample: \n.addSelect_Menu({\n    setName: 'Exemple of name'\n})\n \x1b[0m");if(!n)throw Error("\x1b[31m \noptions is not defined! \x1b[33m \n\nexample: \n.addSelect_Menu({\n    option: [ {label: 'option 1', description: 'this is a description'} ]\n})\n \x1b[0m");if(this.rows[4].length>0)throw Error("\x1b[31m \nYou have reached the button and select menu limit! \x1b[33m \n\nLimits: 25 Buttons or 5 SelectMenus\n \x1b[0m");for(let a of this.rows)if(!(a.length>4)&&!a[0]){a.push({label:e,placeHolder:t||null,options:n,type:"Select_Menu"});break}return d.existsSync("dataStorage")||d.mkdirSync("dataStorage"),d.writeFileSync("dataStorage/"+this.TicketName+".json",JSON.stringify(this.rows)),this}catch(s){console.log(s),process.exit(0)}}}